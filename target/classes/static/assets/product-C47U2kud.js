var y=Object.defineProperty;var I=(i,o,e)=>o in i?y(i,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[o]=e;var c=(i,o,e)=>I(i,typeof o!="symbol"?o+"":o,e);import{R as S,j as t}from"./index-BByiNVVr.js";import{a as u}from"./axios-Bf4ed8-h.js";import{C as L,a as T}from"./CRow-DrMWCTcT.js";import{C as v,a as N}from"./CCardBody-BjKZinef.js";import{C as A}from"./CCardHeader-DISsEpi9.js";import{a as m}from"./index.esm-BIQH8VPz.js";import{C as M,a as b,b as C,c as l,d as w,e as d}from"./CTable-Bwf0hx6f.js";import{P as R}from"./Pagination-pdyTxXLz.js";import{C as U,a as k,b as F,c as _,d as D}from"./CModalTitle-DZEn2SXk.js";import{C as $}from"./CForm-C_AIFBZN.js";import{C as g}from"./CFormLabel-DTjtFQAl.js";import{C as x}from"./CFormInput-DllTwdaB.js";import{C as O}from"./CFormTextarea-apEmMqkT.js";import{C as J}from"./CFormSelect-C9YpequU.js";import"./DefaultLayout-Cjlc4HYz.js";import"./cil-user-Dlmw-Gem.js";import"./CFormControlWrapper-CarACqqe.js";import"./CFormControlValidation-DcmdcCld.js";const P="http://localhost:8080/api/products";class H{getProducts(){return u.get(`${P}/getall`)}getProductAtPage(o){return u.get(`${P}/getProductPage?page=${o}`)}}const f=new H;class it extends S.Component{constructor(e){super(e);c(this,"handlePageChange",(e,a)=>{this.setState({currentPage:a})});c(this,"toggleModal",(e=null)=>{this.setState(a=>({showModal:!a.showModal,editProduct:e,newProduct:e||{img:null,id:"",name:"",description:"",categoryId:""}}))});c(this,"handleInputChange",e=>{const{name:a,value:r,files:h}=e.target;if(a==="img"&&h.length>0){const s=new FileReader;s.onloadend=()=>{this.setState(n=>({newProduct:{...n.newProduct,img:s.result}}))},s.readAsDataURL(h[0])}else this.setState(s=>({newProduct:{...s.newProduct,[a]:r}}))});c(this,"handleSave",()=>{const{newProduct:e,editProduct:a}=this.state,r={id:9999,name:e.name,description:e.description,img:e.img,status:1,categoryId:e.categoryId};if(e.name===""){alert("Vui lòng nhập tên sản phẩm");return}if(e.description===""){alert("Vui lòng nhập mô tả sản phẩm");return}if(e.categoryId===""){alert("Vui lòng chọn thể loại");return}if(a)alert("Sửa sản phẩm"+JSON.stringify(r)),console.log("Sửa sản phẩm",r),fetch(`http://localhost:8080/api/products/update/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(s=>{console.log("data trả về nè",s),s.ok?(alert("Sửa sản phẩm thành công rồi nè"),this.toggleModal(),this.fetchProducts(this.state.currentPage)):(alert("Có lỗi xảy ra khi sửa sản phẩm ở trong"),console.error("Lỗi sửa sản phẩm:",s))}).catch(s=>{alert("Có lỗi xảy ra khi sửa sản phẩm"),console.error("Lỗi sửa sản phẩm:",s)});else{if(!e.img){alert("Vui lòng chọn hình ảnh");return}alert("Thêm sản phẩm"+JSON.stringify(r)),console.log("Thêm sản phẩm",r),fetch("http://localhost:8080/api/products/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(s=>{console.log("data trả về nè",s),s.ok?(alert("Thêm sản phẩm thành công rồi nè"),this.toggleModal(),this.fetchProducts(this.state.currentPage)):(alert("Có lỗi xảy ra khi thêm sản phẩm ở trong"),console.error("Lỗi thêm sản phẩm:",s))}).catch(s=>{alert("Có lỗi xảy ra khi thêm sản phẩm"),console.error("Lỗi thêm sản phẩm:",s)})}});c(this,"handleDelete",e=>{fetch(`http://localhost:8080/api/products/updateStatus/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:0})}).then(r=>{r.ok?(alert("Xóa sản phẩm thành công rồi nè"),this.fetchProducts(this.state.currentPage)):(alert("Có lỗi xảy ra khi xóa sản phẩm"),console.error("Lỗi xóa sản phẩm:",r))}).catch(r=>{alert("Có lỗi xảy ra khi xóa sản phẩm"),console.error("Lỗi xóa sản phẩm:",r)})});this.state={products:[],categories:[],currentPage:1,pageLimit:0,perPage:5,showModal:!1,editProduct:null,newProduct:{img:null,id:"",name:"",description:"",categoryId:""}}}componentDidMount(){f.getProducts().then(e=>{const{data:a}=e,r=Math.ceil(a.length/this.state.perPage);this.setState({pageLimit:r})}).catch(e=>{console.error("Lỗi fetch products:",e)}),this.fetchProducts(1),this.fetchCategories()}componentDidUpdate(e,a){a.currentPage!==this.state.currentPage&&this.fetchProducts(this.state.currentPage)}fetchProducts(e){f.getProductAtPage(e).then(a=>{const{data:r}=a;this.setState({products:r})}).catch(a=>{console.error("Lỗi fetch products:",a)})}fetchCategories(){fetch("http://localhost:8080/api/categories/getall").then(a=>a.json()).then(a=>{this.setState({categories:a}),alert("data categories"+JSON.stringify(a)),console.log("data categories"+JSON.stringify(a))}).catch(a=>{console.error("Lỗi fetch categories:",a),alert("Lỗi fetch categories:",a)})}render(){const{products:e,currentPage:a,pageLimit:r,showModal:h,newProduct:s}=this.state;return Array.isArray(e)?t.jsxs(L,{children:[t.jsx(T,{children:t.jsxs(v,{children:[t.jsxs(A,{children:["Product Information",t.jsx(m,{color:"primary",className:"float-end",onClick:()=>this.toggleModal(),children:"Thêm sản phẩm"})]}),t.jsxs(N,{children:[t.jsxs(M,{children:[t.jsx(b,{children:t.jsxs(C,{children:[t.jsx(l,{children:"Hình ảnh"}),t.jsx(l,{children:"ID"}),t.jsx(l,{children:"Tên sản phẩm"}),t.jsx(l,{children:"Mô tả"}),t.jsx(l,{children:"Thể loại"}),t.jsx(l,{children:"Chỉnh sửa"})]})}),t.jsx(w,{children:e.map((n,j)=>t.jsxs(C,{children:[t.jsx(d,{children:t.jsx("img",{src:n.img,alt:"product",className:"product-image"})}),t.jsx(d,{children:n.id||"N/A"}),t.jsx(d,{children:n.name||"N/A"}),t.jsx(d,{children:n.description||"N/A"}),t.jsx(d,{children:this.state.categories.map(p=>p.id===n.categoryId?p.categoryName:null)}),t.jsxs(d,{children:[t.jsx(m,{color:"warning",onClick:()=>this.toggleModal(n),children:"Sửa"}),t.jsx(m,{color:"danger",onClick:()=>this.handleDelete(n.id),children:"Xóa"})]})]},j))})]}),t.jsx(R,{count:r,page:a,onChange:this.handlePageChange,variant:"outlined",shape:"rounded"})]})]})}),t.jsxs(U,{visible:h,onClose:()=>this.toggleModal(),children:[t.jsx(k,{children:t.jsx(F,{children:this.state.editProduct?"Chỉnh sửa sản phẩm":"Thêm sản phẩm"})}),t.jsx(_,{children:t.jsxs($,{children:[t.jsxs("div",{className:"mb-3",children:[t.jsx(g,{htmlFor:"productImage",children:"Hình ảnh"}),t.jsx(x,{type:"file",id:"productImage",name:"img",onChange:this.handleInputChange})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx(g,{htmlFor:"productName",children:"Tên sản phẩm"}),t.jsx(x,{type:"text",id:"productName",name:"name",value:s.name,onChange:this.handleInputChange})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx(g,{htmlFor:"productDescription",children:"Mô tả"}),t.jsx(O,{id:"productDescription",name:"description",rows:3,value:s.description,onChange:this.handleInputChange})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx(g,{htmlFor:"categoryId",children:"Thể loại"}),this.state.categories.length>0&&t.jsxs(J,{id:"categoryId",name:"categoryId",value:s.categoryId,onChange:this.handleInputChange,children:[t.jsx("option",{value:"",children:"Chọn thể loại"}),this.state.categories.map(n=>t.jsx("option",{value:n.id,children:n.categoryName},n.id))]})]})]})}),t.jsx(D,{children:t.jsx(m,{color:"primary",onClick:this.handleSave,children:this.state.editProduct?"Cập nhật":"Lưu"})})]})]}):(console.error("Products is not an array:",e),null)}}export{it as default};
